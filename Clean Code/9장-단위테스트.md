# 단위 테스트

테스트 코드에 대해서 설명한다.

그 중 테스트 주도 개발에 대해서 설명한다.

## 깨끗한 테스트 코드 유지하기

이것이 뜻하는 바는 아래와 같은 프로세스를 의미한다.

1. 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
2. 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
3. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

이 3가지 단계를 리듬감있게 타는 것이 중요하다고 말한다.

테스트 코드는 우리의 Product 코드를 단순히 검증하기 위한 용도가 아니다.

이 같은 내용이 클린 코드에서는 `깨끗한 테스트 코드 유지하기` 라는 말로 표현한다.

`지저분해도 빨리` 라는 말은 무슨 의미를 가질까? 책에서는 `지저분해도 빨리` 를 가진 팀은 변수이름은 신경 쓸 필요가 없고,
간결하거나 서술적일 필요가 없고, 주의깊게 볼 필요가 없다고 한다.

이렇게 될 경우 문제가 있다.

Product 코드가 조금이라도 변경된다면, 수많은 테스트 코드는 쉽게 무너져 버린다. 단순히 테스트 커버리지를
올리기 위한 용도는 좋지 않다.

테스트 코드를 깨끗하게 짰다면(?) 테스트에 쏟아 부은 노력은 허사로 돌아가지 않았을 것이다.

테스트 코드는 실제 코드 못지 않게 중요하다. 테스트 코드는 사고와 설계와 주의가 필요하다.

### 테스트는 유연성, 유지보수성, 재사용성을 제공한다.

깨끗한 코드가 의미하는 바는 바로 유연성과 유지보수성, 재사용성을 제공한다는 것이다.

테스트 코드의 장점으로, 이런 이야기를 종종한다. '유지보수가 쉽다'

이 말은 즉, 테스트 케이스가 있으면 **변경**이 쉬워진다는 의미이다.

### 깨끗한 테스트 코드

이것이 의미하는 것이 무엇일까?

클린코드에서는 `가독성, 가독성, 가독성` 이라고 한다.

명료성, 단순성, 풍부한 표현력이 바로 주 요소이다.

테스트 코드는 최소의 표현으로 많은 것을 나타내야 한다.

### 도메인에 특화된 테스트 언어

도메인에 특화된 언어 라는 것은 엄청나게 대단하기 보단, 리팩토링하면서 진화된 API 이다.

예를 들어

```java
assertSubString("test page", xml);
assertNotSubString("test page", xml);
```

와 같이 표현하고자 하는 것을 더 잘 표현될 수 있도록 도와주는 것을 의미한다.

### 이중 표준

테스트 API 코드에 적용하는 표준은 실제 코드에 적용하는 표준과 확실히 다르다.

단순하고, 간결하고, 표현력이 풍부해야 하지만, 실제 코드만큼 효율적일 필요는 없다.

```java
//Before

@Test
public void turnOnLoTempAlarmAtThreashold() {
    ha.setTemp(WAT_TOO_COLD);
    controller.tic();
    assertTrue(hw.heaterState());
    assertTrue(hw.blowerState());
    assertFalse(hw.coolerState());
    assertFalse(hw.hiTempAlaram());
    assertTrue(hw.loTempAlaram());
        }
```

코드를 검증하기 위해 테스트 코드가 있다. 그러나, 테스트 코드가 세세한 사항을 모두 체크한다면, 그건 불안정한 코드가 된다.

검증하려는 부분에 대해서 내가 전달하고 싶은 부분만 테스트 될 수 있어야 한다.
위 코드에서는 `단지 시스템 최종 상태가 온도가 '급강하' 했는지` 알고 싶을 뿐이다.

그렇다면 아래와 같은 코드가 될 것이다.
```java
//After

@Test
public void turnOnLoTempAlarmAtThreashold() {
    wayTooCold();
    assertEquals("HBchL", hw.getState())
        }
```

재미있는 대목이다. "HBchL" 이란, Before 코드에 assertXXX 로 표현된 내용을 함축해서 표현하고 있다.

대문자는 "켜짐", 소문자는 "꺼짐" 이다.

이는 '그릇된 정보를 피하라' 라는 규칙에 위반되지만, 그럼에도 불구하고 테스트 코드 관점에서는 읽기가 편리하다.

## 테스트당 Assert 하나

가혹하게 지켜야 한다.

바로 위에서 예시로 보였던 예제에서도 여러개의 Assert 를 한 개로 축약하니 가독성이 높아졌다.

마틴 파울러는 테스트 당 Assert 하나만 사용해야 한다는 규칙을 철저하게 지켜야 한다고 말한다.

### 테스트 당 개념 하나

바로 위 내용이였던 테스트당 Assert 하나 라는 의미는 테스트 당 개념 하나 라는 의미와 크게 다르지 않다.

"개념 당 assert 문 수를 최소로 줄여라"

"테스트 함수 하나는 개념 하나만 테스트하라"


### F.I.R.S.T

Fast:

테스트는 빨라야 한다.


Independent:

각 테스트는 서로 의존하면 안된다.


Repeatable:

테스트는 어떤 환경에서도 반복 가능해야 한다.


Self-Validating:

테스트는 부울값으로 결과를 내야 한다. 성공 아니면 실패이다.


Timely:

테스트는 적시에 작성해야 한다.

