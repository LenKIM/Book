# 테스트 더블과 모의 객체

배울 내용

- 스텁, 페이크, 모의 객체를 사용해서 테스트를 단순화하는 방법
- 모의 객체가 무엇인지, 모의 객체를 언제 사용해야 하는지, 언제 사용하지 말아야 하는지에 대한 이해
- 모의할 수 없는 객체를 모의하는 방법



지금까지는 하나의 메소드, 하나의 클래스만 테스트했다면, 클래스가 다른 클래스에 의존되어 있다면 어떻게 테스트할 수 있을까? 물론 한번에 다같이 테스트 하고 싶겠지만, 여기서는 격리된 방식으로 테스트하는 데 초점을 맞추자.



**그렇다면 왜 격리 테스트를 할까?**

- 테스트 대상 클래스를 구체적인 의존성과 함께 수행하는 일이 너무 느리거나
- 너무 힘들거나
- 너무 많은 일을 해야 할 수 있기에

![image-20240123130548089](https://raw.githubusercontent.com/LenKIM/images/master/2024-01-23/image-20240123130548089.png)



다른 클래스에 의존하는 클래스를 테스트할 때 의존성을 사용하지 않는 방법을 알아야내야 한다. 이때 테스트 더블(test double) 을 활용한다.

테스트 더블을 사용하면, 가짜 구성요소 B를 완전히 제어할 수 있으므로, **테스트 맥락** 이 중요해진다.

다른 객체의 동작을 시뮬레이션하는 객체를 사용하면 다음과 같은 장점을 가질 수 있다.

- 더 **큰 제어권**을 가진다.
- **시뮬레이션이 빠르다.**
- 개발자는 모의 객체를 설계 기법으로 사용하여 **클래스 간의 상호작용을 반영**

### 1. 더미, 페이크, 스텝, 모의 객체, 스파이

**더미 객체**

- 시뮬레이션하려는 클래스같이 실제로 동작하는 구현체이지만, 단순한 방법으로 동작한다.

**페이크 객체**

- 시뮬레이션하려는 클래스가 실제와 비슷하게 동작하는 구현체

**스텁**

- 테스트 과정에서 수행된 호출에 대해 하드 코딩된 응답 제공

**모의 객체(mock)**

- 메서드의 응답을 설정할 수 있는 객체로서,스텁과 유사하다. 스텁과 다른 점은, 모의 객체는 모든 상호작용을 저장해서 나중에 단언문에 활용할 수 있도록 한다.

**스파이**

- 의존성을 감시하는데, 실제 객체를 감싸서 그 행동을 관찰한다.

#### 2.1 의존성 스텁화

#### 2.2 모의 객체와 기댓값

#### 2.3 인수 포획

#### 2.4 예외 시뮬레이션

### 3. 협업에서의 모의 객체

**3.1 모의해야 하는 대상과 하지 말아야 하는 대상**



*실용적으로 의존성이 다음과 같은 종류일 때 모의 객체나 스텁을 사용합니다.*

- 의존성이 너무 느린 경우
- 의존성이 외부 인프라와 통신하는 경우
- 의존성을 시뮬레이션하기 힘든 경우

*반대로, 다음과 같은 경우에서는 모의 객체나 스텁을 꺼리게 한다.*

- 엔티티
- 네이티브 라이브러리와 유틸리티 메소드
- 충분히 단순한 의존성



### 

