# 테스트 조직

4장 테스트 조직  
4.1 AAA로 테스트 일관성 유지
- 준비(Arrange)
- 실행(Act)
- 단언(Assert)
 
때에 따라 사후(After): 정리되었는지(cleanup)

4.2 동작 테스트 vs 메서드 테스트
- 테스트를 작성할 때는 클래스 동작에 집중해야 하며 개별 메서드를 테스트한다고 생각하면 안된다.
- 예를 들어 출금 테스트하는데, makeSingleDeposit/makeMultipleDeposits 을 한다고 하면, getBalance() 메서드를 호출해야 하는데,getBalance()테스트 하는 코드를 작성하고 싶지 않으니, 테스트 메서드를 다음과 같이 변경해보자.
  - makeSingleWithdrawal
  - makeMultipleWithdrawal
  - attemptToWithdrawalTooMuch

 하고 싶은 이야기는 단위 테스트를 작성할 때는 먼저 전체적인 시각에서 시작해야 합니다. 개별 메서드를 테스트하는 것이 아니라 클래스의 종합적인 동작을 테스트해야 합니다.


4.3 테스트와 프로덕션 코드의 관계  

__4.3.1 테스트와 프로덕션 코드 분리  
- 개발자가 작성하는 테스트 코드는 프로그래머만 하는 활동이다. 고객이나 최종 사용자, 비프로그래머는 테스트 결과를 보거나 실행만 한다.
- 테스트를 작성하는 행위가 프로덕션 시스템에 영향을 주지 않는다는 것이 아니다. 더 많은 단위 테스트를 작성할수록 설계를 변경했을 때 테스트 작성이 훨씬 용이해지는 경우가 늘어날 것이기 때문이다.

__4.3.2 내부 데이터 노출 vs 내부 동작 노출  
- 테스트가 프로덕션 코드와 같은 패키지에 있으면 그 클래스에 대해 패키지 수준으로 접근할 수 있습니다. 다른 패키지에 있다면 자바 리플렉션으로 접근권한을 우회할 수 있지만, 둘다 하지 않는 것 이다.
- 내부 행위를 테스트하려는 충동이 든다면 설계에 문제가 있는 것. 묻혀 있는 수많은 흥미로운 행동은 거의 단일 책임원을 어기게 되고, SRP는 어떤 클래스가 작고 단일 목적을 가져야 함을 의미하며, 가장 좋은 해결책은 흥미로운 private 메서드를 추출하여 다른 클래스로 이동하는 것. 그렇게 하면 그 클래스의 유용한 public 메서드가 됩니다.

4.4 집중적인 단일 목적 테스트의 가치
- JUnit 을 활용하여 다수의 케이스를 별도의 JUnit 테스트 메서드로 분리. 각각에는 검증하는 동작을 표현하는 이름을 붙이세요.
- 테스트를 분리하면 다음과 같은 이점을 얻는데,
  - 단언이 실패했을 때 실패한 테스트 이름이 표시되기 때문에 어느 동작에서 문제가 있는지 빠르게 파악할 수 있습니다.
  - 실패한 테스트를 해독하는 데 필요한 시간을 줄일 수 있습니다.
  - 모든 케이스가 실행되었음을 보장할 수 있습니다. 단언이 실패하면 현재 테스트 메서드는 중단합니다.


4.5 문서로서의 테스트  

- 단위 테스트는 우리가 만드는 클래스에 대한 지속적이고 믿을 수 있는 문서 역할. 테스트는 코드 자체로 쉽게 설명할 수 없는 가능성들을 알려줍니다. 어떤 의미에서는 테스트가 없었으면 주석으로 적어 놓았을 많은 내용을 보충하기도 합니다.

__4.5.1 일관성 있는 이름으로 테스트 문서화  

- 테스트 케이스를 단일 메서드로 결합할수록 테스트 이름 또한 일반적이고 의미를 잃어 갑니다. mastches 라는 테스트 이름은 그 행동에 대해 아무것도 이야기 해 주지 못합니다.
- 좀 더 작은 테스트로 이동할수록 각각은 분명한 행동에 집중합니다. 또 각 테스트 이름에 더 많은 의미 부여. 테스트하려는 맥락을 제안하기보다는 어떤 맥락에서 일련의 행동을 호출했을 때 어떤 결과가 나오는지를 명시하세요.

- 합리적인 테스트 이름은 아마도 단어 7개정도로 구성되며, 더 긴 이름은 이해하기 어려운 이름이 될 수 있고, 설계 문제가 될 수도 있습니다.
  - 더 멋지고 설명적인 이름은 다음 양식을 따릅니다
    - doingSomeOperationGeneratesSomeResult(어떤 동작을 하면 어떤 결과가 나온다.)
    - someResultOccursUnderSomeCondition(어떤 결과는 어떤 조건에서 나온다)
    - 만약 행위주도개발을 한다면,
      - givenSomeContextWhenDoingSomeBehaviorThenSomeResultOccurs(주어진 조건에서 어떤 일을 하면 어떤 결과가 나온다)

- 어떤 형식이든 일관성을 유지하는 것이 중요.


__4.5.2 테스트를 의미 있게 만들기  

- 다른 사람이 테스트가 어떤 일을 하는지 파악하기 어려워 한다면 주석을 추가하는 것만으로 끝내지 말고 테스트 이름을 개선해야 합니다.
  - 또는 다음과 같은 것도 고려해야 합니다.
    - 지역 변수 이름 개선
    - 의미 있는 상수 도입
    - 햄크레스트 단언 사용
    - 커다란 테스트를 작게 나누어 집중적인 테스트 만들기
    - 테스트 군더더기들을 도우미 메서드와 @Before 메서드로 이동
  - `테스트 이름과 코드를 재작업하여 부가적으로 주석을 넣지 않고도 스토리를 알 수 있도록 만드세요.`

4.6 @Before와 @After (공통 초기화와 정리) 더 알기  

__4.6.1 BeforeClass와 AfterClass 애너테이션  

4.7 녹색이 좋다: 테스트를 의미 있게 유지    
__4.7.1 테스트를 빠르게  

`여러분이 견딜 수 있는 만큼 많은 테스트를 실행하세요.`

__4.7.2 테스트 제외  
4.8 마치며  