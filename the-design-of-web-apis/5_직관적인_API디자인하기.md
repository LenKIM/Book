## 사용하기 좋은 API 디자인

### 컨셉에 맞는 직관적인 표현 만들기

- 사용성을 높이는 첫 단계는 프로바이더 관점을 피하고 컨슈머 관점에 집중하는 것
- 이름, 데이터 포맷 및 데이터와 관련된 여러분의 의사결절은 API의 사용성을 크게 향상 시킬 수도 반대로 크게 손상시킬 수 있다. 컨슈머 관점에 초점을 맞추고 사용자를 염두에 두고 설계하면서 선택한 표현이 합리적인지 그리고 컨슈머가 쉽게 이해할 수 있는지 고려하기만 하면 됩니다.'

##### 1. 명확한 이름 짓기
- 약어을 사용하지 않기

##### 2. 사용하기 쉬운 데이터 타입과 포맷 정하기
- 적절한 데이터 포맷을 선택하는 것이 중요하다.

##### 3. 바로 사용할 수 있는 데이터 선택하기
- 바로 사용 가능한 데이터을 제공하여 컨슈머의 작업을 단순화해야 한다.

### 2. 직관적인 상호작용

- UUID 보다 Long 을 사용하는 이유로 값이 최소화되고 사용자가 입력하기 쉬운 데이터가 된다.


#### 관련된 에러의 성공 피드백 식별하기

- 발생 가능한 모든 에러 피드백 식별하기

![|675](https://i.imgur.com/nFFuIno.jpg)

에러도 종류가 있다.

1. 규격에 맞지 않는 에러(malformed requeste error)   
   ex) ISO 8601 문자열을 입력받는 date(일자)속성에 UNIX 타입스퍁ㅁ프가 잘못 들어오는 경우
2. 기능적 에러(functional error)   
   ex) 송금 금액은 계좌 잔액이 부족하거나 당일 최대 송금 한도에 걸릴 수도 있으며, 내부 계좌의 금액을 외부로 송금하는 것이 금지되어 있을 수 있다.
3. 서버 에러(server error)  
   ex) 데이터베이스 서버의 장애나 구현의 버그로 인한 문제가 생김


에러을 나열할 때는 항상 컨슈머의 관점으로 바라봐야 한다.

그리고 API는 의사소통하는 것이기 때문에 적절한 에러 피드백을 반환해야 한다.

![](https://i.imgur.com/cT4Aj9o.jpg)

에러 코드을 통해 피드백을 주는 것도 중요하지만, 리스폰스도 중요하다.

`"message": "금액은 필수입니다"`

이렇게 메세지을 내려주면, 사람이라면 이해하기 쉽지만 기계라면 어렵다. 그러므로 프로그래밍적인 방법으로 문제를 유발하는 속성을 알려주는 편이 더 좋다.

```
{
	"source": "amount",
	"type": "AMOUNT_OVER_SAFE",
	"message": "금액이 사용가능 금액을 초과합니다."
}
```

위와 같은 형태로 포과적인 타입 형태의 자세한 에러 리스폰스을 내려준다.

에러가 발생한다면 이를 사용하는 유저에게 철저하게 반환해야 한다.

```
{
	"message": "Invalid request",
	"errors": [
		{
		"source": "amount",
		"type": "AMOUNT_OVER_SAFE",
		"message": "Source is mandatory"
		},
		{
		"source": "destination",
		"type": "MISSING_MANDATORY_PROPERTY",
		"message": "Destination is mandatory"
		},
	]
}
```

반대로, 유용한 성공 피드백을 반환하는 것도 중요하다.

![|450](https://i.imgur.com/f2MN0WJ.png)

"2XX(성공) 계열의 상태 코드는 클라이언트의 요청이 성공적으로 접수, 이해 및 수락되었음을 나타낸다."

기본적으로 성공 피드백이 유용해지기 위해서는 무슨 일이 벌어졌는지, 그 뒤 무엇을 해야 하는지를 알려줘야 한다.
- 입력과 출럭은 반드시 직관적이어야 한다.
- 모든 가능한 에러는 반드시 식별되어야 한다.
- 에러 피드백은 반드시 무엇이 문제인지 알려주고 가능하다면 컨슈머 스스로 해결할 수 있게 도와주어야 한다.
- 여러 개의 에러를 하나씩 따로 응답하는 것은 피해야 한다.
- 성공 피드백은 무슨 일이 벌졌는지와 그 다음에 무엇을 해야하는지에 대한 정보을 제공해주는 것이 좋다.


#### 효율적인 사용 흐름(Flow) 디자인하기

![|525](https://i.imgur.com/7D9OfPv.jpg)

입력과 피드백에 주의를 기울여야 하는 것은 API도 동일하다. 그러면 직관적인 목표의 연쇠를 만들 수 있다.

아래 예시는 API 목표 캔버스이다.

![|750](https://i.imgur.com/JnEmpA2.png)

위 캔버스는 즉시 이체에 대한 설명을 한다.

![](https://i.imgur.com/TJDp77R.jpg)

API 목표의 연쇄로 가는 첫 번째 단계는 컨슈머가 제공할 수 있는 간단한 입력이나 연쇄에 포함된 다른 목표를 요청하고 리퀘스트/에러 사이클을 제한하기 위해 완전하고 유용한 에러 피드백을 반환하는 것이다.


완벽하게 직관적인 흐름을 디자인하려면 다음 규칙을 따라야 한다.

- 각 목표가 직관적인 상호작용을 제공하는지 확인한다.
- 목표의 호출에서 입력과 출력이 한결 같은지 확인한다.
- 가능한 경우 기존 목표에 데이터를 추가하여 오류를 방지하여 새로운 목표를 만든다.
- 가능한 경우 컨슈머의 관점에서 기능적으로 합리적이라면 목표들을 통합한다.
- 연쇄되어있는 모든 목표는 상태가 없어야(stateless) 한다.
