# 예측 가능한 API 을 디자인한다는 건 무슨말일까?

 한가지 예시로 우리는 이런 경험을 한 적이 있다. 어떤 전자기기을 받자마자 메뉴얼을 보지 않고도 사용법을 알고 있는 경우가 있다.



어떻게 이것이 가능할까? 사물이 전달해주는 예측 가능한 API 가 우리을 이끈건 아닐까?

## 일관성 유지하기

 일관성을 유지한다는 것은 어떤 것일까? API 에서 일관성을 유지한다는 건 무슨 의미일까?

 **1. 대표적으로 일관된 데이터을 디자인하는 것이다.**

데이터는 API 의 핵심이다. 리소스(resource), 파라미터(parameter), 리스폰스(response), 그리고 프로퍼티(property). 컨슈머가 쉽게 이해할 수 있도록 이름, 타입, 포맷, 조직화에 심혈을 기울어야 한다.

 그 첫번째는 바로 이름 짓기이다.

*서로 다른 컨텍스트에 속한 같은 데이터*

|                | 일관성 없는 이름 | 일관성 있는 이름    |
| -------------- | ---------------- | ------------------- |
| 계좌조회       | accountNumber    | accountNumber       |
| 계좌 정보 조회 | number           | accountNumber       |
| 송금하기       | source           | sourceAccountNumber |

*유사한 타입의 다른 데이터*

|                | 일관성 없는 이름 | 일관성 있는 이름 |
| -------------- | ---------------- | ---------------- |
| 계좌조회       | balanceDate      | balanceDate      |
| 계좌 정보 조회 | dateOfCreation   | CreationDate     |
| 송금하기       | executionDay     | executionDate    |



또는  데이터 타입과 포맷이 다를 수도 있다.

|                | 일관성 있는 이름    | 일관성 없는 타입/포맷 | 일관성 있는 타입/ 포맷 |
| -------------- | ------------------- | --------------------- | ---------------------- |
| 계좌조회       | accountNumber       | "000123456"           | "000123456"            |
| 계좌 정보 조회 | accountNumber       | "123456"              | "000123456"            |
| 송금하기       | sourceAccountNumber | 123456                | "000123456"            |



API 관점에서도 전반적인 통일성을 추구해야 한다.

API의 URL을 살펴보면, 아래 그림을 살펴보자.

![image-20221120124211654](https://tva1.sinaimg.cn/large/008vxvgGgy1h8bg06zpahj31ka0rojy1.jpg)

위 그림을 보면 /accounts/{accountNumber} 와 /transfers/delayed/{transferId} 는 URL의 조직이 다르다.

/transfers/delayed/{transferId} 의 URL은 콜렉션의 이름과 리소스 ID가 예기치 못한 형태로 되어 있다. **그렇기에 /delayed-transfers/{transferId}** 를 사용하는 편이 좋다.



저자 생각에 URL은 각 계층은 항상 같은 뜻을 포함하는 것이 좋다고 한다. 컨슈머가 조직화된 패턴에 익숙해진다면, 자신들이 접할 모든 API도 그런 식이길 기대하게 되기 때문이다.



**2. 일관적인 목표 디자인하기**

API 동작은 목표에 따라 결정된다. 입력을 기다렸다가 성공 또는 오류 피드백을 반환하며, 이러한 모든 목표는 다양한 절차적 흐름을 구성하는데, 사용할 수 있다.

예를 들어 **계좌 읽기**와 **사용자 정보 가져오기** 라는 목표가 있다.

같은 유형의 동작을 하지만 읽기와 가져오기라는 서로 다른 동사를 이용해 일관성을 결여시켰다. 차라리 계좌 읽기, 사용자 정보 읽기 가 더 나을지도 모른다.

이 두 가지 목표는 바라보는 경로만 다를 뿐 모두  GET /resource-경로 형태의 표현으로 같은 HTTP 메서드를 사용한다.

성공이나 에러 메시지에도 적용되며, 데이터의 표현과 포맷에도 적용될 수 있다.

일관성이란 단순히 API 형태뿐만 아니라 작동 방식에도 영향을 미친다.



**3. 일관성의 4단계**

- 1단계 - API 내부에 일관성이 존재
- 2단계 - 팀 API / 회사 / 조직 간의 일관성이 존재
- 3단계 - 도메인 간의 API의 일관성이 존재
- 4단계 - 외부 세계와 일관성이 존재



**4. 타인을 따라하자: 일반적인 관행과 표준을 준수하기**

 API에서 사용할 수 있는 표준이 존재한다. 그것을 잘 활용하자.



**5. 유지하기 어렵고 현명하게 적용해야하는 일관성**

일관성을 대가로 사용성을 저해시키거나 상식에 반대되어서는 안된다. 때로는 일관성에만 치중하면 유연성이 떨어지고 디자인 프로세스가 엄청나게 복잡해져 일관성만 있고 사용할 수조차 없는 API가 될 수 있다는 것을 깨달아야 한다.

## 적응 가능하게 하기

 같은 개념에 대해서 다르게 표현하거나 취사 선택하거나 대상에 맞추어 표현을 바꾸는 것은 책에 구한되는 이야기만이 아니다. API에도 동일하게 적용된다. 

 그럼 API을 어떻게 적용하게 만들 수 있을까?

다음 3가지 방법이 있다.

**1. 다른 포맷으로 제공하거나 응답하기**

콘텐츠 네비게이션이 만약 JSON 이였다면, 이것을 CSV로 표현할 수 있다. 

> REST 제약사항: 유니폼 인터페이스(Uniform interface)
>
>  모든 상호작용이 리소스의 상태와 표준 HTTP 메서드, 그리고 이것들이 무엇을 의미하는지와 해당 리소스에서 무슨 일이 벌어졌는지 알 수 있는 모든 데이터를 제공해야 한다고 명시한다. 하나의 리소스는 컨슈머에게 프로바이더를 통해서 JSON, CSV 등과 같은 다양한 표현을 이용해 매우 다양한 포맷으로 제공할 수 있다. 이러한 접근은 REST API의 컨슈머들이 적응할 수 있고 API를 예측 가능하게 만드는 강력한 메카니즘이다.

**2. 국제화와 현지화**

Accept-Language 을 사용할 수 있다.

**3. 필터, 페이지, 정렬 적용하기**



## 탐색 가능하게 하기



 **1. 메타 데이터 제공하기**

메타데이터는 컨슈머들에게 현재 그들이 어느 페이지에 있으며, 무엇을 할 수 있는지도 알려 줄 수 있다.

**2. 하이퍼미디어 API 만들기**

**3. HTTP 프로토콜의 장점 이용하기**

OPTIONS 라는 메서드을 사용하여 HTTP 메서드를 가져올 수 있다.
