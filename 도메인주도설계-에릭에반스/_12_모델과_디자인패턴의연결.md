# 모델과 디자인 패턴의 연결



**디자인 패턴과 도메인 패턴의 차이점은 무엇인가?**

> 패턴에 대한 시각은 어떤 것이 패턴이고 어떤 것이 아닌가를 분석하는 데 영향을 준다. 어떤 사람에게는 패턴인 것이 다른 사람에게는 기본적인 요소일 수도 있다. 이 책에서는 일정 수준의 추상화를 갖춘 패턴에 전념했다. 디자인 패턴은 클래스로 코딩되는 연결리스트와 해시 테이블에 관한 설계를 패턴화하는 것이 아니다. 그렇다고 애플리케이션 전체나 하위 시스템을 지원하는 복잡한 설계에 대한 패턴도 아니다. 이 책에서 논의하는 디자인 패턴은 특정한 상황에서 일반적인 설계 문제를 해결하고자 상호 교류하는 수정가능한 객체와 클래스에 관해 설명한 것이다 - 디자인패턴책



기술적인 디자인 패턴?

 도메인에서 마주치는 의미있는 개념에 사용할 수 있다.

**COMPOSITE와 STRATEGY는 고전적인 디자인 패턴을 다른 방식으로 생각함으로써 도메인 문제에 어떻게 적용할 수 있는지를 보여준다.**



## STRATEGY(전략, POLICY[정책]라고도 함)

알고리즘군을 정의하고, 각 알고리즘을 캡슐화한 후 알고리즘들을 상호 교환 가능하게끔 만든다. STRADTEGY패턴을 이용하면 어떤 알고리즘을 사용하는 클라이언트와 상관없이 해당 알고리즘을 변경할 수 있다.

![image-20230312112355470](https://raw.githubusercontent.com/LenKIM/images/master/2023-03-12/image-20230312112355470.png)



 도메인 모델에는 기술적인 이유로 필요한 것이 아니라 실제적으로 문제 도메인 관점에서 의미 있는 프로세스가 존재한다. **여러 종류의 프로세스 중 하나를 선택해야 할 경우 적절한 프로세스를 선택하는 데 따르는 복잡성과 다수의 프로세스가 존재한다는 사실 자체에 내포된 복잡성이 결합되어 결국 감당하기 어려운 지경에 이르고 만다.**



 우리는 프로세스의 중심 개념과 변경되는 부분을 분리하고자 한다. 두 부분을 분리한다면 중심 프로세스와 그 외의 부가적인 선택사항을 더욱 명확하게 식별할 수 있게 될 것이다.

 STRADTEGY 는 모델에 포함된 하나의 개념으로 사용되며 해당 모델을 구현한 코드에 반영된다. 이와 같은 요구사항으로 비교적 더 안정적인 부분으로부터 변경되기 쉬운 부분을 분리해야 하는 것도 있다.

 프로세스에서 변화되는 부분을 별도의 전략(strategy) 객체로 분리해서 모델에 표현하라. 프로세스의 규칙과 프로세스를 제어하는 행위를 서로 분리하라. STRATEGY 디자인 패턴에 따라 규칙이나 대체 가능한 프로세스를 구현하라. 다양한 방식으로 변형된 전략 객체는 프로세스의 서로 다른 처리 방식을 표현한다.



 STRATEGY를 디자인 패턴으로 바라보는 전통적인 관점에서는 각기 다른 알고리즘 간에 상호 대체할 수 있는 능력에 중점을 두는 반면, 도메인 패턴으로 사용하는 관점에서는 프로세스 또는 정책적인 규칙과 같은 하나의 개념을 표현하는 능력에 중점을 둔다.

![image-20230312120023922](https://raw.githubusercontent.com/LenKIM/images/master/2023-03-12/image-20230312120023922.png)

  도메인 계층에서 기술적인 디자인 패턴을 사용할 때는 부가적인 동기 부여와 함께 별도의 의미 계층을 추가해야 한다. 구현 기술로서의 패턴이 그 자체만으로도 가치가 있긴 하지만 STRATEGY를 실제 업무 전략이나 정책과 연관시킬 때 패턴은 유용한 구현 기술 이상의 가치를 지닌다.

## Composite 패턴

![image-20230312120600747](https://raw.githubusercontent.com/LenKIM/images/master/2023-03-12/image-20230312120600747.png)



- 복잡한 도메인을 모델링하는 동안 종종 중요한 객체가 여러 개의 작은 부분으로 조합되어 구성돼 있는 경우가 있다. 객체를 구성하는 부분 역시 더 작은 부분으로 구성되고, 더 작은 부분은 다시 더 세밀한 부분으로 분할되어 각 부분이 임의의 깊이로 중첩되기도 한다. 어떤 도메인에서는 객체를 구성하는 개별 부분의 개념적 수준이 전혀 다른 반면, 어떤 의미에서는 전체를 구성하는 부분이 단지 크기가 더 작을 뿐 전체와 완전히 동일한 종류인 경우도 있다.
- 중첩돼 있는 복합 객체 간의 관련성을 모델에 반영하지 않을 경우 계층구조상의 각 수준에 공통적인 행위를 중복시킬 수 밖에 없으며 복합 객체 내에 객체들을 중첩할 수 있는 유연성이 손상된다(예를 들면, 복합 객체는 동일한 수준에 위치한 다른 복합 객체를 내부에 중첩할 수 없으며 중첩할 수 있는 수준의 수는 고정적이다). **계층구조상의 각 수준에서 다루는 개념에 차이가 없더라도 클라이언트는 서로 다른 수준을 처리하기 위해 각 다른 인터페이스를 사용해야 한다.**
- 도메인 모델에 디자인 패턴을 적용할 경우 가장 우선적으로 고려할 사항은 적용하려는 패턴의 기본 아이디어가 정말로 도메인 개념에 적합한지 여부다. COMPOSITE을 적용하면 연관된 객체를 재귀적으로 탐색하기가 좀 더 수월해지겠지만 정말로 도메인 개념 같의 부분/전체 계층 구조가 존재하는가? 하부의 모든 부분이 실제로 동일한 유형의 개념으로 구성되는 추상화를 발견했는가? 만약 그러한 추상화를 발견했다면 COMPOSITE을 적용해 모델의 측면을 좀더 명확하게 표현하는 동시에 디자인 패턴의 설계및 구현과 관련된 연구겨롸를 활용할 수 있다.
- COMPOSITE 내부에 포함된 모든 구성요소를 포괄하는 추상 타입을 정의하라. 컨테이너에 포함된 항목의 집계 정보를 반환할 수 있게 정보를 제공하는 메서드를 컨테이너에 구현하라. "단말(Leaf) 노드의 경우 자신의 값을 기반으로 정보를 제공하는 메서드를 구현하라. 클라이언트는 추상 타입만을 사용하므로 컨테이너와 단말 노드를 구분하지 않아도 된다."

